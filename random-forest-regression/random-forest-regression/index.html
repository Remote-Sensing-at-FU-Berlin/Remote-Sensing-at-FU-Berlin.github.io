
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../basic-landsat/basic-landsat/">
      
      
        <link rel="next" href="../../1_Laserscanning_lidR/1_Laserscanning_lidR/">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Random Forest Regression - REMOTE SENSING AND GEOINFORMATICS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-green">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mapping-ellenberg-values-using-a-randomforest-regression-and-two-types-of-optical-remote-sensing-datasets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="REMOTE SENSING AND GEOINFORMATICS" class="md-header__button md-logo" aria-label="REMOTE SENSING AND GEOINFORMATICS" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            REMOTE SENSING AND GEOINFORMATICS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Random Forest Regression
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Remote-Sensing-at-FU-Berlin/Remote-Sensing-at-FU-Berlin.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Remote-Sensing-at-FU-Berlin.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../qgis/01-GUI/" class="md-tabs__link md-tabs__link--active">
        Prof. Dr. Fassnacht
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../gis/installation/" class="md-tabs__link">
        GIS
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../schuelerpraktikum/handout/" class="md-tabs__link">
        Other
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="REMOTE SENSING AND GEOINFORMATICS" class="md-nav__button md-logo" aria-label="REMOTE SENSING AND GEOINFORMATICS" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    REMOTE SENSING AND GEOINFORMATICS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Remote-Sensing-at-FU-Berlin/Remote-Sensing-at-FU-Berlin.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Remote-Sensing-at-FU-Berlin.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Prof. Dr. Fassnacht
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Prof. Dr. Fassnacht
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          QGIS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          QGIS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/01-GUI/" class="md-nav__link">
        Getting to know the graphical user interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/02-vector-data/" class="md-nav__link">
        Loading and visualizing Shapefiles / Vector data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/03-raster-data/" class="md-nav__link">
        Loading and visualizing raster data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/04-general-tools/" class="md-nav__link">
        Useful general tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/05-digitizing/" class="md-nav__link">
        Basic vector processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/06-selections/" class="md-nav__link">
        Spatial and semantic selection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/07-elevation/" class="md-nav__link">
        Working with elevation raster datasets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/08-map-making/" class="md-nav__link">
        Making a map
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qgis/09-spatial-interpolation/" class="md-nav__link">
        Spatial interpolation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          R
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basic-landsat/basic-landsat/" class="md-nav__link">
        Basic Landsat Processing
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Random Forest Regression
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Random Forest Regression
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets-used-in-this-tutorial" class="md-nav__link">
    Datasets used in this Tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-loading-the-sentinel-2-the-hymap-hyperspectral-and-the-reference-data" class="md-nav__link">
    Step 1: Loading the Sentinel-2, the HyMap (hyperspectral) and the reference data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-extracting-the-spectral-information-at-the-plot-locations-and-train-the-randomforest-model" class="md-nav__link">
    Step 2: Extracting the spectral information at the plot locations and train the RandomForest model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-apply-the-randomforest-models-to-the-full-image" class="md-nav__link">
    Step 3: Apply the RandomForest models to the full image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1_Laserscanning_lidR/1_Laserscanning_lidR/" class="md-nav__link">
        Getting started with processing laserscanning data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../radiative-transfer-model/radiative-transfer-model/" class="md-nav__link">
        Radiative Transfer Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../treespeciesclassification/treespeciesclassification/" class="md-nav__link">
        Classification of tree species using hyperspectral data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BFAST/BFAST/" class="md-nav__link">
        Analysing time series with BFAST and NPPHEN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../landscape_metrics/landscape_metrics/" class="md-nav__link">
        Calculation of Landscape Metrics from a Land-cover raster map
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../spatial_autocorrelation/spatial_autocorrelation/" class="md-nav__link">
        Calculating semivariograms and Autocorrelograms
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          GEE
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          GEE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MSRS_1_GEE_basics/MSRS_1_GEE_basics/" class="md-nav__link">
        Preparing time series data stacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MSRS_1_GEE_basics2/MSRS_1_GEE_basics2/" class="md-nav__link">
        Preparing annual time series data stacks and conducting time series analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          SNAP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          SNAP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../planetary-sciences/01-download-ls-and-s2/" class="md-nav__link">
        Download of Landsat and Sentinel satellite images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          GIS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GIS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          R
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/visualization-and-map/" class="md-nav__link">
        Visualization and Map
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/digitalization/" class="md-nav__link">
        Digitalization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/attributes-filters-and-metadata/" class="md-nav__link">
        Attributes, Filters and Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/geoprocesing-and-reference-and-coordinate-systems/" class="md-nav__link">
        Geoprocesing and reference and coordinate systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/interpolation/" class="md-nav__link">
        Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gis/dem/" class="md-nav__link">
        Digital Elevation Models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schuelerpraktikum/handout/" class="md-nav__link">
        School internship
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mintoring/mintoring/" class="md-nav__link">
        Mintoring
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/Remote-Sensing-at-FU-Berlin/Remote-Sensing-at-FU-Berlin.github.io/tree/main/docs/random-forest-regression/random-forest-regression.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
    </a>
  
  


<h1 id="mapping-ellenberg-values-using-a-randomforest-regression-and-two-types-of-optical-remote-sensing-datasets">Mapping Ellenberg values using a RandomForest regression and two types of optical remote sensing datasets<a class="headerlink" href="#mapping-ellenberg-values-using-a-randomforest-regression-and-two-types-of-optical-remote-sensing-datasets" title="Link zu dieser Sektion">&para;</a></h1>
<p>Fabian Fassnacht</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Link zu dieser Sektion">&para;</a></h2>
<p>In this lecture you will learn how to apply RandomForest in a regression
scenario. The learned steps will include:</p>
<ul>
<li>Loading a hyperspectral and a Sentinel-2 image</li>
<li>Visualizing a hyperspectral and a Sentinel-2 image</li>
<li>Loading a reference datset containing Ellenberg indicator values
  collected in the field</li>
<li>Building a RandomForest model between the Ellenberg values and the
  spectral information of the remote sensing datasets</li>
<li>Predicting the RandomForest model to the full image</li>
</ul>
<p>The datasets applied in this tutorial are available here:
<a href="https://drive.google.com/open?id=16HZiL0AltUr7ftNMviLIrHfb5Y9vTGCu">https://drive.google.com/open?id=16HZiL0AltUr7ftNMviLIrHfb5Y9vTGCu</a></p>
<h2 id="datasets-used-in-this-tutorial">Datasets used in this Tutorial<a class="headerlink" href="#datasets-used-in-this-tutorial" title="Link zu dieser Sektion">&para;</a></h2>
<p>In this tutorial we will use a Sentinel-2 image which has been
preprocessed as described in the following Tutorial:</p>
<p>ADD LINK</p>
<p>The image used in the Tutorial has additionally been re-projected to a
German coordinate reference system (EPSG-code: 31468) in QGIS.</p>
<p>The original Sentinel-2 dataset can be downloaded from several webpages
including the USGS Earth explorer (the same webpage where we downloaded
our Landsat data), as well as the official ESA Science Data Hub. How to
download the corresponding images will be demonstrated in the course.
The links can be found in below as well as on the ILIAS page of the
course:</p>
<p><a href="https://earthexplorer.usgs.gov/">https://earthexplorer.usgs.gov/</a> .</p>
<p>ADD LINK</p>
<p>Furthermore, we will make use of an airborne hyperspectral or imaging
spectroscopy image that was collected with the HyMap sensor. This
dataset is comparable to a multispectral image but contain a lot more
bands which continuously cover the spectra wavelengths regions between
approximately 400 and 2400 nm. The HyMap dataset has a higher spatial
resolution as compared to the Sentinel-2 image.</p>
<p>The field reference data and the hyperspectral data for this tutorial
are the data sets used in Schmidtlein, S., Zimmermann, P., Schüpferling,
R., Weiß, C. (2007): Mapping the floristic continuum: Ordination space
position estimated from imaging spectroscopy. Journal of Vegetation
Science 18(1), pp. 131–140.</p>
<h2 id="step-1-loading-the-sentinel-2-the-hymap-hyperspectral-and-the-reference-data">Step 1: Loading the Sentinel-2, the HyMap (hyperspectral) and the reference data<a class="headerlink" href="#step-1-loading-the-sentinel-2-the-hymap-hyperspectral-and-the-reference-data" title="Link zu dieser Sektion">&para;</a></h2>
<p>As first step, load all necessary R packages by executing the following
code:</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="s">&quot;terra&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;sf&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;randomForest&quot;</span><span class="p">)</span>
</code></pre></div>
<p>R will raise an error in case a package is not installed yet. If this is
the case, please install the packages either through the main menu of
Rstudio by selecting <strong>“Tools” =></strong> <strong>“Install packages”</strong> and then
following the appearing dialogue, or by entering the corresponding R
code to install the packages into the console. E.g., to install the
package “terra” use the code:</p>
<div class="highlight"><pre><span></span><code><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;terra&quot;</span><span class="p">)</span>
</code></pre></div>
<p>After all packages are successfully installed, load the images using two
steps. First, change the path to the folder containing the image:</p>
<div class="highlight"><pre><span></span><code><span class="nf">setwd</span><span class="p">(</span><span class="s">&quot;/home/florian/tutorials-fabian/random-forest-regression/&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Then execute the stack command to load the image. To check whether you
are in the correct folder, you can display all files of the folder using
the <strong>list.files()</strong>-command:</p>
<div class="highlight"><pre><span></span><code><span class="nf">list.files</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> [1] &quot;data.zip&quot;                       &quot;murnau.hymap&quot;                  
 [3] &quot;murnau.hymap.aux.xml&quot;           &quot;murnau.hymap.hdr&quot;              
 [5] &quot;murnau_fin.dbf&quot;                 &quot;murnau_fin.prj&quot;                
 [7] &quot;murnau_fin.shp&quot;                 &quot;murnau_fin.shx&quot;                
 [9] &quot;random-forest-regression.md&quot;    &quot;random-forest-regression.Rmd&quot;  
[11] &quot;random-forest-regression_files&quot; &quot;s2_murnau_dhdn_4.tif&quot;          
[13] &quot;s2_murnau_dhdn_4.tif.aux.xml&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># to load the Sentinel-2 image</span>
<span class="n">s2_img</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rast</span><span class="p">(</span><span class="s">&quot;s2_murnau_dhdn_4.tif&quot;</span><span class="p">)</span>
<span class="c1"># to load the HyMap image</span>
<span class="n">hym_img</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rast</span><span class="p">(</span><span class="s">&quot;murnau.hymap&quot;</span><span class="p">)</span>
</code></pre></div>
<p>We can then have a look at the two loaded images by running:</p>
<div class="highlight"><pre><span></span><code><span class="nf">plotRGB</span><span class="p">(</span><span class="n">s2_img</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hist&quot;</span><span class="p">)</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-5-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-5-1.png" width="100%" /></a></p>
<div class="highlight"><pre><span></span><code><span class="nf">plotRGB</span><span class="p">(</span><span class="n">hym_img</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hist&quot;</span><span class="p">)</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-5-2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-5-2.png" width="100%" /></a></p>
<p>Finally, we will also add the reference dataset which is stored in a
Shapefile:</p>
<div class="highlight"><pre><span></span><code><span class="n">vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_read</span><span class="p">(</span><span class="s">&quot;murnau_fin.shp&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Reading layer `murnau_fin&#39; from data source 
  `\\wsl.localhost\Ubuntu-20.04\home\florian\tutorials-fabian\random-forest-regression\murnau_fin.shp&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 40 features and 21 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4438489 ymin: 5278619 xmax: 4439000 ymax: 5279240
Projected CRS: Transverse_Mercator
</code></pre></div>
<p>We can check the location of the sample plots in the field by plotting:</p>
<div class="highlight"><pre><span></span><code><span class="nf">plotRGB</span><span class="p">(</span><span class="n">hym_img</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hist&quot;</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Warning in plot.sf(vec, add = T): ignoring all but the first attribute
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-7-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../random-forest-regression_files/figure-gfm/unnamed-chunk-7-1.png" /></a><!-- --></p>
<p>If you want, you can also re-plot the Sentinel-2 image and add the
field-plot location to the Sentinel-2 image. You will quickly find out,
that the Sentinel-2 image is covering a much larger area than the HyMap
image. If you want to have better comparable maps at the end of the
Tutorial, you can clip the Sentinel-2 image to the extent of the HyMap
image, using R commands that you already learnt in earlier Tutorials.</p>
<h2 id="step-2-extracting-the-spectral-information-at-the-plot-locations-and-train-the-randomforest-model">Step 2: Extracting the spectral information at the plot locations and train the RandomForest model<a class="headerlink" href="#step-2-extracting-the-spectral-information-at-the-plot-locations-and-train-the-randomforest-model" title="Link zu dieser Sektion">&para;</a></h2>
<p>Next, we will first extract the spectral information of the pixels that
overlap with the locations of the field sampling plots by running:</p>
<div class="highlight"><pre><span></span><code><span class="n">preds_s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="n">s2_img</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">preds_hym</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="n">hym_img</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
</code></pre></div>
<p>Then, we will build the RandomForest model between the Ellenberg
indicator values stored in reference dataset and the spectral
information we just extracted.The first model will use the N indicator
value stored in the attribute table of the Shapefile which can be
accessed here:</p>
<div class="highlight"><pre><span></span><code><span class="n">vec</span><span class="o">$</span><span class="n">MEANR</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> [1] 7.800000 7.200000 6.700000 6.766667 7.333333 6.366667 6.900000 4.366667
 [9] 4.800000 5.766667 5.433333 2.966667 3.066667 2.100000 5.700000 3.033333
[17] 1.900000 1.533333 7.066667 5.300000 5.133333 2.366667 1.600000 1.700000
[25] 6.466667 4.933333 1.966667 1.533333 1.633333 6.600000 6.466667 5.000000
[33] 1.400000 1.733333 1.766667 6.766667 6.600000 1.500000 1.533333 1.733333
</code></pre></div>
<p>The N indicator value stands for “Nitrogen” and high values indicate
locations with a high availability of Nitrogen (one indicator for good
plant growth), while low values indicate areas where N is sparse
(nutrient limited environment). See also:
<a href="https://owlcation.com/stem/Understanding-Ellenberg-Indicator-Values-For-Beginners">https://owlcation.com/stem/Understanding-Ellenberg-Indicator-Values-For-Beginners</a></p>
<p>To train the model for Sentinel-2 data we run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># use set.seed() to be able to reproduce the outputs (RandomForest contains some random components and will otherwise always lead to a slightly different results)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="n">model_n_s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">randomForest</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">preds_s2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">$</span><span class="n">MEANN</span><span class="p">,</span><span class="w"> </span><span class="n">ntree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">ncol</span><span class="p">(</span><span class="n">preds_s2</span><span class="p">)),</span><span class="w"> </span><span class="n">na.action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omit</span><span class="p">)</span>
</code></pre></div>
<p>As you can see, we are setting two variables to parameterize the
RandomForest algorithm: <strong>ntree</strong>, which is the number of trees to be
grown and where a default value of 500 is used and <strong>mtry</strong> which
indicates the number of random predictor variables that are tried-out at
each node-split of the decision trees (compare theoretical lecture on
RandomForest heard in the course). For <strong>mtry</strong> we also use the
recommended standard value which is the square-root of the number of
predictors used to train the model.</p>
<p>To train a similar model for the HyMap data, we run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># use set.seed() to be able to reproduce the outputs (RandomForest contains some random components and will otherwise always lead to a slightly different results)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="n">model_n_hym</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">randomForest</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">preds_hym</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">$</span><span class="n">MEANN</span><span class="p">,</span><span class="w"> </span><span class="n">ntree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">ncol</span><span class="p">(</span><span class="n">preds_hym</span><span class="p">)),</span><span class="w"> </span><span class="n">na.action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omit</span><span class="p">)</span>
</code></pre></div>
<p>To compare the performance of the two models, we can have a look at the
out-of-bag error of RandomForest by simply calling the variable in which
the model was stored:</p>
<div class="highlight"><pre><span></span><code><span class="n">model_n_s2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Call:
 randomForest(x = preds_s2, y = vec$MEANN, ntree = 500, mtry = sqrt(ncol(preds_s2)),      na.action = omit) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 3

          Mean of squared residuals: 1.064896
                    % Var explained: 30.41
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">model_n_hym</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Call:
 randomForest(x = preds_hym, y = vec$MEANN, ntree = 500, mtry = sqrt(ncol(preds_hym)),      na.action = omit) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 11

          Mean of squared residuals: 0.3378566
                    % Var explained: 77.92
</code></pre></div>
<p>We can see that int he given case, the HyMap data performed notably
better than the Sentinel-2 data. This may have several reasons in the
given example - one potential problem is that the Sentinel-2 data was
acquired more than 10 years later than the field data. That is, some
changes might have occurred in the vegetation composition in the
meantime - even though the ecosystem can be considered rather stable.
Furthermore, the HyMap data provides notably more spectral information
which may also be crucial to sucessfully map the subtle changes in the
vegetation composition that finally explain the variance in N indicator
values. Finally, the differences in spatial resolution of the two
datasets (4 m vs. 10 m) could also lead to some problems as the field
datasets used to calibrate the models were not necessarily
representative for a complete 10 x 10 m area.</p>
<p>Let us have a closer look at the results by producing some scatterplots
between the values estimated the model and the reference values.</p>
<p>For Sentinel-2, we run:</p>
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="n">model_n_s2</span><span class="o">$</span><span class="n">predicted</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="o">$</span><span class="n">MEANN</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-13-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-13-1.png" width="100%" /></a></p>
<p>Correspondingly, for HyMap we run:</p>
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="n">model_n_hym</span><span class="o">$</span><span class="n">predicted</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="o">$</span><span class="n">MEANN</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-14-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-14-1.png" width="100%" /></a></p>
<p>Here we can see, that eventhough the HyMap data shows a lot stronger
correlation with N indicator values obtained from the field data,
Sentinel-2 seems to still have a reasonably well correlation and might
have some potential for mapping the Ellenberg N values.</p>
<h2 id="step-3-apply-the-randomforest-models-to-the-full-image">Step 3: Apply the RandomForest models to the full image<a class="headerlink" href="#step-3-apply-the-randomforest-models-to-the-full-image" title="Link zu dieser Sektion">&para;</a></h2>
<p>As last step of this Tutorial, we will now apply the trained
RandomForest models to the full extent of the satellite and airborne
remote sensing datasets to obtain maps showing estimations of the N
indicator value for the full image.</p>
<p>To accomplish this we run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># apply randomforest model to the complete image</span>
<span class="n">pred_n_s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">s2_img</span><span class="p">,</span><span class="w"> </span><span class="n">model_n_s2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">pred_n_hym</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">hym_img</span><span class="p">,</span><span class="w"> </span><span class="n">model_n_hym</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</code></pre></div>
<p>To have a look at the predicted maps, we run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># plot prediction map</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">pred_n_s2</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">))</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-16-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-16-1.png" width="100%" /></a></p>
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="n">pred_n_hym</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">))</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-16-2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-16-2.png" width="100%" /></a></p>
<p>As the Sentinel-2 image covers a notably larger region than the HyMap
image, the two images are hardly comparable. Hence, we crop the
Sentinel-2 prediction map to the same extent as the HyMap prediction map
by running:</p>
<div class="highlight"><pre><span></span><code><span class="n">pred_n_s2_sm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">crop</span><span class="p">(</span><span class="n">pred_n_s2</span><span class="p">,</span><span class="w"> </span><span class="nf">ext</span><span class="p">(</span><span class="n">pred_n_hym</span><span class="p">))</span>
</code></pre></div>
<p>The cropped image has now the same extent as the HyMap image and is
directly comparable by running:</p>
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="n">pred_n_s2_sm</span><span class="p">)</span>
</code></pre></div>
<p><a class="glightbox" href="../random-forest-regression_files/figure-gfm/unnamed-chunk-18-1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="../random-forest-regression_files/figure-gfm/unnamed-chunk-18-1.png" width="100%" /></a></p>
<p>We can now see, that eventhough the RandomForest model for the
Sentinel-2 data performed notably worse than the HyMap image, the
general trends in the prediction maps, are still quite comparable.</p>
<p>One more important point to be considered in the predicted maps is that
the validity of the model only applies for areas that are comparable to
the areas in which reference data were collected. In the example this
relates to the bog-areas of the “Murnauer Moos” stocked with vegetation.
The large-area predictions of the Sentinel-2 image are hence not likely
to contain meaninful results. In other words: If I train a RandomForest
model to predict N values with reference data collected in grasslands
and apply this modle to a forest or a river, the results will not make
any sense.</p>
<p>Finally, we can save the output maps to raster-file by running:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># save prediction</span>
<span class="nf">writeRaster</span><span class="p">(</span><span class="n">pred_n_s2</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rf_predicted_n_s2.tif&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GTiff&quot;</span><span class="p">)</span>
<span class="nf">writeRaster</span><span class="p">(</span><span class="n">pred_n_s2_sm</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rf_predicted_n_s2_sm.tif&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GTiff&quot;</span><span class="p">)</span>
<span class="nf">writeRaster</span><span class="p">(</span><span class="n">pred_n_hym</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rf_predicted_n_hym.tif&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GTiff&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="exercise">Exercise<a class="headerlink" href="#exercise" title="Link zu dieser Sektion">&para;</a></h2>
<p>To practice the just learned steps a bit more, you can try to build
additional RandomForest models for the other Ellenberg indicator values
available in the reference datasets. You can access for example the F
values (wetness) at:</p>
<div class="highlight"><pre><span></span><code><span class="n">vec</span><span class="o">$</span><span class="n">MEANF</span>
</code></pre></div>
<p>And the R values (pH) at:</p>
<div class="highlight"><pre><span></span><code><span class="n">vec</span><span class="o">$</span><span class="n">MEANR</span>
</code></pre></div>
<p>Furthermore, you can try to examine how adding additional Sentinel-2
scenes collected at different times during the vegetation season
influence the model results. To accomplish this, you will have to
download some additional Sentinel-2 scenes, pre-process them using the
SNAP-Toolbox and finally reproject them to the coordinate reference
system indicated above. Then you can stack them into a single
raster-stack and repeat the analysis. It might be good to also clip the
dataset to approximately the area covered by the field-data to speed-up
the data processing.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../basic-landsat/basic-landsat/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basic Landsat Processing" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Basic Landsat Processing
              </div>
            </div>
          </a>
        
        
          
          <a href="../../1_Laserscanning_lidR/1_Laserscanning_lidR/" class="md-footer__link md-footer__link--next" aria-label="Next: Getting started with processing laserscanning data" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Getting started with processing laserscanning data
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; CC-BY-SA-4.0 license - Freie Universität Berlin Institute of Geographical Sciences Remote Sensing and Geoinformatics
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "search.suggest", "search.highlight", "content.action.edit", "content.code.copy", "navigation.tracking", "navigation.tabs", "navigation.path", "navigation.top", "navigation.footer", "navigation.instant"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../javascripts/mathjax.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>